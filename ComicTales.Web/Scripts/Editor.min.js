var ComicTales;(function(n){function i(n){var i=new t(n);ko.applyBindings(i)}n.Init=i;var t=function(){function t(n){this.storyId=n,this.tiles=ko.observableArray([]),this.isLoading=ko.observable(!1),this.hasUpdates=ko.observable(!1),this.loadTiles(),this.initConnection()}return t.prototype.refresh=function(){this.loadTiles()},t.prototype.addNewTile=function(){var t=this;new n.EditTileDialog(function(n){t.saveTile(n)}).open()},t.prototype.editTile=function(t){new n.EditTileDialog(function(){},t).open()},t.prototype.deleteTile=function(){},t.prototype.saveTile=function(n){var t=this;$.post("/Story/"+this.storyId+"/AddTile",n,function(){return t.notifyUpdated()})},t.prototype.saveStory=function(){var n=this;$.post("/Story/"+this.storyId+"/Save",function(){return n.notifyUpdated()})},t.prototype.notifyUpdated=function(){$.connection.comicStoryNotificationsHub.server.notifyHasUpdates(this.storyId)},t.prototype.loadTiles=function(){var n=this;this.isLoading(!0),$.get("/Story/"+this.storyId+"/GetTiles",function(t){n.isLoading(!1),n.updateTiles(t)})},t.prototype.updateTiles=function(n){var t=this;this.tiles.removeAll(),$.each(n.tiles,function(n,i){return t.tiles.push(i)})},t.prototype.initConnection=function(){var n=this,t=$.connection.comicStoryNotificationsHub;t.client.notifyHasUpdates=function(){console.log("Recieve updates notification!"),n.hasUpdates(!0)},$.connection.hub.start().done(function(){console.log("Now connected, connection ID="+$.connection.hub.id+", transport="+$.connection.hub.transport.name),t.server.join(n.storyId)}).fail(function(){console.log("Could not Connect!")})},t}();n.EditorViewModel=t})(ComicTales||(ComicTales={}))